<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CoinFlip Galaxy ğŸŒŒ V 4.1 - YÃ¼ksek BaÅŸarÄ±m GÃ¼ncellemesi</title>
    <meta name="description" content="GeliÅŸmiÅŸ olasÄ±lÄ±k ve yazÄ± tura simÃ¼lasyonu. YÃ¼ksek BaÅŸarÄ±m ve Kozmetikler!">
    <style>
        /* =========================================
           1. CSS DEÄÄ°ÅKENLERÄ° & TEMA
           ========================================= */
        :root {
            --primary: #6c5ce7;
            --primary-dark: #5b4bc4;
            --secondary: #a29bfe;
            --accent: #00b894;
            --danger: #ff7675;
            --warning: #fdcb6e;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-muted: #636e72;
            --border-radius: 16px;
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-md: 0 10px 20px rgba(0,0,0,0.08);
            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --coin-size: 140px;
            --flip-duration: 2s; /* VarsayÄ±lan hÄ±z */
        }

        body.dark-mode {
            --primary: #8980f4;
            --primary-dark: #6c5ce7;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --secondary: #404040;
        }
        
        .fast-flip {
            --flip-duration: 0.5s !important; 
        }

        /* Yeni: Arka Plan TemasÄ± iÃ§in Ã¶zel alan */
        body.theme-applied {
            transition: background-image 1s ease-in-out;
        }

        /* =========================================
           2. GENEL YAPI & RESET
           ========================================= */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: var(--font-family);
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            /* Kozmetik Arka PlanÄ± iÃ§in yer tutucu */
            background-image: none;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* Header */
        .app-header {
            width: 100%; padding: 15px 20px;
            background: var(--card-bg);
            box-shadow: var(--shadow-sm);
            display: flex; justify-content: space-between; align-items: center;
            position: fixed; top: 0; left: 0; z-index: 100;
            transition: background-color 0.3s;
        }
        .app-logo { font-weight: 800; font-size: 1.2rem; color: var(--primary); letter-spacing: -0.5px; }
        .header-controls { display: flex; gap: 10px; align-items: center; }
        .icon-btn { background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--text-main); transition: transform 0.2s; }
        .icon-btn:active { transform: scale(0.9); }
        
        /* Currency Display */
        #currency-display {
            background: var(--warning); color: var(--text-main); padding: 5px 12px;
            border-radius: 20px; font-weight: 700; font-size: 0.9rem;
            display: flex; align-items: center; gap: 5px;
        }

        /* Main Content */
        .main-container {
            margin-top: 80px; width: 95%; max-width: 480px;
            display: flex; flex-direction: column; align-items: center;
            padding-bottom: 100px;
        }

        /* =========================================
           3. OYUN ALANI (COIN)
           ========================================= */
        .coin-stage {
            perspective: 1000px;
            width: var(--coin-size); height: var(--coin-size);
            margin: 40px 0;
            position: relative;
        }
        
        #coin {
            width: 100%; height: 100%;
            position: relative;
            transform-style: preserve-3d;
            border-radius: 50%;
            box-shadow: 
                inset 0 0 20px rgba(255,255,255,0.5),
                0 15px 35px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center;
            font-size: 4rem;
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            border: 8px solid #fff;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: border-radius 0.3s, background 0.3s;
        }
        
        body.dark-mode #coin { border-color: #333; }

        .is-flipping { animation: flip3d var(--flip-duration) cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        @keyframes flip3d {
            0% { transform: rotateY(0) scale(1); }
            50% { transform: rotateY(900deg) scale(1.4); }
            100% { transform: rotateY(1800deg) scale(1); }
        }

        #result-text {
            font-size: 1.5rem; font-weight: 700;
            color: var(--primary); margin-bottom: 20px;
            min-height: 1.5em; text-align: center;
            transition: opacity 0.3s, color 0.3s;
        }
        
        .coin-message {
             font-size: 0.9rem; color: var(--text-main); font-weight: 600; margin-top: 10px;
             padding: 5px 10px; border-radius: 8px;
        }
        
        /* ÅANS ETKÄ°NLÄ°ÄÄ° MESAJI */
        .coin-message[style*="background-color: var(--accent)"],
        .coin-message[style*="background-color: var(--warning)"] {
            color: var(--card-bg) !important;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); opacity: 0.9; }
            to { transform: scale(1.03); opacity: 1; }
        }

        /* =========================================
           4. KONTROLLER & DASHBOARD
           ========================================= */
        .dashboard-card {
            background: var(--card-bg);
            width: 100%;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }

        .control-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 14px; border: none; border-radius: 12px;
            font-weight: 600; font-size: 1rem; cursor: pointer;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        
        .btn-primary { background-color: var(--primary); color: #fff; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3); }
        .btn-primary:active { transform: translateY(2px); box-shadow: none; }
        .btn-primary:disabled { background-color: #a0a0a0; cursor: not-allowed; box-shadow: none; }
        
        .btn-secondary { background-color: var(--bg-color); color: var(--text-main); }
        .btn-secondary:hover { background-color: #e0e0e0; }
        .dark-mode .btn-secondary { background-color: var(--secondary); color: var(--text-main); }
        .dark-mode .btn-secondary:hover { background-color: #555; }
        
        .btn-danger { background-color: var(--danger); color: #fff; }
        .btn-danger:active { transform: translateY(2px); box-shadow: none; }


        .auto-section {
            display: flex; gap: 10px; align-items: center;
            background: var(--bg-color); padding: 10px; border-radius: 12px;
        }
        
        .select-box {
            padding: 10px; border-radius: 8px; border: 1px solid #ccc;
            background: var(--card-bg); color: var(--text-main); flex-grow: 1;
        }
        .dark-mode .select-box { background: #333; border-color: #555; }

        /* =========================================
           5. MAÄAZA & KOZMETÄ°KLER
           ========================================= */
        .shop-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;
        }
        .shop-item {
            background: var(--bg-color); padding: 15px; border-radius: var(--border-radius);
            text-align: center; border: 2px solid transparent; transition: all 0.2s;
        }
        .shop-item.equipped { border-color: var(--accent); background: #e8f8f5; }
        .dark-mode .shop-item.equipped { background: #1e3a30; }
        .shop-item-icon { font-size: 2.5rem; display: block; margin-bottom: 5px; }
        .shop-price { color: var(--warning); font-weight: 700; margin-top: 5px; }

        /* YÃ¼kseltmeler iÃ§in farklÄ± stil */
        .upgrade-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            margin-bottom: 15px;
            border-left: 5px solid var(--accent);
        }
        .upgrade-info {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px;
        }
        .upgrade-level { font-weight: 700; color: var(--primary-dark); }
        .upgrade-cost { font-weight: 700; color: var(--warning); }
        .upgrade-desc { font-size: 0.9rem; color: var(--text-muted); }


        /* =========================================
           6. MODALLER
           ========================================= */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(3px);
            z-index: 200; opacity: 0; pointer-events: none; transition: opacity 0.3s;
            display: flex; justify-content: center; align-items: flex-end;
        }
        .modal-backdrop.open { opacity: 1; pointer-events: all; }
        
        .modal-content {
            background: var(--card-bg); width: 100%; max-width: 500px;
            border-radius: 24px 24px 0 0; padding: 30px;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            max-height: 85vh; overflow-y: auto;
        }
        .modal-backdrop.open .modal-content { transform: translateY(0); }

        .menu-list { list-style: none; padding: 0; margin: 0; }
        .menu-list li {
            padding: 15px; border-bottom: 1px solid var(--bg-color);
            cursor: pointer; display: flex; align-items: center; gap: 15px;
            font-size: 1.1rem;
        }
        .dark-mode .menu-list li { border-color: #333; }
        .menu-list li:last-child { border-bottom: none; }
        .menu-list li:active { background-color: var(--bg-color); }

        /* Achievements Grid */
        .achievements-grid {
            /* BaÅŸarÄ±mlarÄ± daha kompakt gÃ¶stermek iÃ§in grid yapÄ±sÄ± bÃ¼yÃ¼tÃ¼ldÃ¼. */
            display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 8px;
        }
        .achievement-item {
            background: var(--bg-color); border-radius: 10px; padding: 8px;
            text-align: center; opacity: 0.4; filter: grayscale(100%); transition: all 0.3s;
            cursor: pointer; 
            border: 1px solid transparent;
        }
        .achievement-item.unlocked { opacity: 1; filter: grayscale(0%); background: #e8f8f5; border: 1px solid var(--accent); }
        .dark-mode .achievement-item.unlocked { background: #1e3a30; }
        .ach-icon { font-size: 1.2rem; display: block; margin-bottom: 5px; }
        .ach-icon.skin-reward { color: var(--primary); font-size: 1.5rem; } /* Skin Ã¶dÃ¼lÃ¼ olanlar */

        /* BaÅŸarÄ±m AÃ§Ä±klama Modal */
        #ach-info-modal .modal-content {
            max-width: 350px;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20%;
        }
        #ach-info-modal.open { align-items: center; } 
        #ach-info-modal h3 { margin-top: 0; color: var(--primary); }
        #ach-info-modal p { font-size: 1rem; color: var(--text-main); }
        #ach-reward { font-weight: 700; color: var(--warning); margin-top: 10px; }


        /* Input Groups */
        .input-group { margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
        .input-text { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 8px; background: var(--bg-color); color: var(--text-main); }
        .dark-mode .input-text { background: #333; border-color: #555; }
        .input-color { width: 40px; height: 40px; border: none; background: none; cursor: pointer; }
        .input-emoji { width: 50px; text-align: center; }

        .version-footer {
            position: fixed; bottom: 10px; left: 0; width: 100%; text-align: center;
            font-size: 0.75rem; color: var(--text-muted); z-index: 90;
        }
        
        /* Stat Row (Analist ModalÄ± iÃ§in) */
        .stat-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; font-size: 0.95rem;
        }
        .stat-bar-wrapper { flex-grow: 1; height: 10px; background: var(--bg-color); border-radius: 5px; margin: 0 10px; overflow: hidden; }
        .dark-mode .stat-bar-wrapper { background: #333; }
        .stat-bar { height: 100%; border-radius: 5px; transition: width 0.5s ease; }
    </style>
</head>
<body id="game-body">

    <div id="audio-engine-status" style="display:none;"></div>

    <header class="app-header">
        <div class="app-logo">ğŸŒŒ CoinFlip Galaxy</div>
        <div class="header-controls">
            <span id="currency-display">ğŸ’° 0</span>
            <button class="icon-btn" onclick="Game.ui.openShopModal()">ğŸ›ï¸</button>
            <button class="icon-btn" onclick="Game.ui.openAnalystModal()">ğŸ§ </button>
            <div id="streak-badge" class="streak-badge" style="display: none;">ğŸ”¥ 0</div>
            <button class="icon-btn" onclick="Game.ui.toggleMenu()">â˜°</button>
        </div>
    </header>

    <div class="main-container">
        
        <div class="coin-stage">
            <div id="coin">?</div>
        </div>

        <div id="result-text">Hadi BaÅŸlayalÄ±m!</div>
        <div id="flip-message" class="coin-message" style="display:none;">+1 Jeton KazanÄ±ldÄ±!</div>

        <div class="dashboard-card">
            <div class="control-grid">
                <button id="btn-flip" class="btn btn-primary" onclick="Game.logic.flip()">
                    <span>ğŸ²</span> ParayÄ± At
                </button>
                <button id="btn-reset" class="btn btn-secondary" onclick="Game.logic.resetStats()">
                    <span>ğŸ”„</span> Ä°statistik SÄ±fÄ±rla
                </button>
            </div>
            
            <div class="auto-section">
                <select id="auto-limit" class="select-box">
                    <option value="10">10 Kez</option>
                    <option value="50">50 Kez</option>
                    <option value="100">100 Kez</option>
                    <option value="1000">1.000 Kez</option>
                    <option value="10000">10.000 Kez</option>
                    <option value="999999">SÄ±nÄ±rsÄ±z</option>
                </select>
                <button id="btn-auto" class="btn btn-secondary" onclick="Game.logic.toggleAuto()">
                    ğŸš€ Otomatik
                </button>
            </div>
        </div>

        <div class="dashboard-card">
            <h3 style="margin-top:0;">ğŸ“Š Ä°statistikler (<span id="mode-name-display">Normal</span>)</h3>
            <div id="stats-container">
                </div>
            <div style="margin-top:15px; font-size:0.9rem; color:var(--text-muted); display:flex; justify-content:space-between;">
                <span>Toplam: <b id="total-flips">0</b></span>
                <span>Rekor Seri: <b id="best-streak">0</b></span>
            </div>
        </div>

        <div class="dashboard-card">
            <h3 style="margin-top:0; font-size:1rem;">ğŸ† BaÅŸarÄ±mlar (<span id="unlocked-achievements-count">0</span> / <span id="total-achievements-count">1000+</span>)</h3>
            <div class="achievements-grid" id="achievements-list">
                </div>
        </div>

    </div>

    <div class="version-footer">V 4.1 - YÃ¼ksek BaÅŸarÄ±m ve Kozmetik GÃ¼ncellemesi</div>
    <canvas id="confetti-canvas"></canvas>

    <div id="main-menu-modal" class="modal-backdrop" onclick="if(event.target===this) Game.ui.toggleMenu()">
        <div class="modal-content">
            <h2 style="margin-top:0;">Ayarlar & Modlar</h2>
            <ul class="menu-list">
                <li onclick="Game.logic.setMode('NORMAL')">ğŸ¯ Normal Mod (YazÄ±/Tura)</li>
                <li onclick="Game.ui.openWeightedModal()">âš–ï¸ AÄŸÄ±rlÄ±klÄ± Mod (AyarlÄ± OlasÄ±lÄ±k)</li>
                <li onclick="Game.logic.setMode('RPS')">âœŠ TaÅŸ-KaÄŸÄ±t-Makas Modu</li>
                <li onclick="Game.logic.setMode('SIMPLE')">â“ Basit Mod (Evet/HayÄ±r)</li>
                <li onclick="Game.logic.setMode('DICE')">ğŸ² Zar Modu (1-6)</li>
                <li onclick="Game.logic.setMode('CATEGORY')">ğŸ“š 12 Kategori Modu</li>
                <li onclick="Game.ui.openCustomModal()">âœï¸ Ã–zel Mod OluÅŸtur</li>
                <hr style="width:100%; border-color: var(--bg-color);">
                <li onclick="Game.ui.toggleTheme()">ğŸŒ“ Tema DeÄŸiÅŸtir (Koyu/AÃ§Ä±k)</li>
                <li onclick="Game.data.exportData()">ğŸ’¾ Verileri Kaydet (Ä°ndir)</li>
                <li onclick="document.getElementById('import-file').click()">ğŸ“‚ Verileri YÃ¼kle</li>
                <input type="file" id="import-file" style="display:none" onchange="Game.data.importData(this)">
                <hr style="width:100%; border-color: var(--bg-color);">
            </ul>
            <button class="btn btn-danger" style="width:100%; margin-top:10px;" onclick="Game.logic.hardReset()">
                ğŸš¨ HESABI TAM SIFIRLA (Hard Reset)
            </button>
            <button class="btn btn-secondary" style="width:100%; margin-top:10px;" onclick="Game.ui.toggleMenu()">Kapat</button>
        </div>
    </div>

    <div id="shop-modal" class="modal-backdrop" onclick="if(event.target===this) document.getElementById('shop-modal').classList.remove('open')">
        <div class="modal-content">
            <h2>ğŸ›ï¸ MaÄŸaza</h2>
            <p id="shop-currency-display" style="font-weight: 700; color: var(--primary);">Mevcut Jeton: ğŸ’° 0</p>
            
            <h3 style="margin-top: 20px;">ğŸ’° KalÄ±cÄ± YÃ¼kseltmeler</h3>
            <div id="upgrade-section">
                 </div>
            
            <h3 style="margin-top: 20px;">ğŸ¨ Kozmetik ÃœrÃ¼nler</h3>
            <p style="font-size:0.8rem; color:var(--text-muted);">BazÄ± kozmetikler sadece baÅŸarÄ±mlarla aÃ§Ä±labilir.</p>
            <div id="shop-items-grid" class="shop-grid">
                </div>
            <button class="btn btn-secondary" style="width:100%; margin-top:20px;" onclick="document.getElementById('shop-modal').classList.remove('open')">Kapat</button>
        </div>
    </div>

    <div id="analyst-modal" class="modal-backdrop" onclick="if(event.target===this) document.getElementById('analyst-modal').classList.remove('open')">
        <div class="modal-content">
            <h2>ğŸ§  Analiz Merkezi</h2>
            <p style="font-size:0.9rem; color:var(--text-muted);">GeliÅŸmiÅŸ istatistikler ve eÄŸlencelik tahminler.</p>
            
            <div class="dashboard-card" style="margin-bottom: 10px; padding: 15px;">
                <h4 style="margin-top:0;">Toplam BaÅŸarÄ±mlar</h4>
                <div id="analyst-long-stats"></div>
            </div>

            <div class="dashboard-card" style="padding: 15px;">
                <h4 style="margin-top:0;">OlasÄ±lÄ±k AsistanÄ± (EÄŸlence AmaÃ§lÄ±)</h4>
                <p id="analyst-prediction" style="font-size: 1.1rem; font-weight: 600; min-height: 1.5em;"></p>
                <p style="font-size: 0.85rem; color: var(--danger);">*Bu tahminler sadece istatistiksel sapmalara dayanÄ±r, gerÃ§ek sonuÃ§larÄ± garanti etmez.</p>
            </div>
            
            <button class="btn btn-secondary" style="width:100%; margin-top:20px;" onclick="document.getElementById('analyst-modal').classList.remove('open')">Kapat</button>
        </div>
    </div>

    <div id="custom-modal" class="modal-backdrop" onclick="if(event.target===this) document.getElementById('custom-modal').classList.remove('open')">
        <div class="modal-content">
            <h2>âœï¸ Ã–zelleÅŸtir</h2>
            <p style="font-size:0.9rem; color:var(--text-muted)">Min 2, Maks 5 sonuÃ§. Sadece 1 Emoji. Her sonuÃ§ eÅŸit aÄŸÄ±rlÄ±klÄ± olur.</p>
            <div id="custom-inputs"></div>
            <button class="btn btn-secondary" style="width:100%; margin:10px 0;" onclick="Game.ui.addCustomInput()">+ Ekle</button>
            <div class="control-grid">
                <button class="btn btn-primary" onclick="Game.logic.saveCustomMode()">Kaydet ve BaÅŸlat</button>
                <button class="btn btn-secondary" onclick="document.getElementById('custom-modal').classList.remove('open')">Ä°ptal</button>
            </div>
        </div>
    </div>
    
    <div id="weighted-modal" class="modal-backdrop" onclick="if(event.target===this) document.getElementById('weighted-modal').classList.remove('open')">
        <div class="modal-content">
            <h2>âš–ï¸ AÄŸÄ±rlÄ±klÄ± OlasÄ±lÄ±k AyarÄ±</h2>
            <p style="font-size:0.9rem; color:var(--text-muted)">Her sonucun yÃ¼zdesini belirleyin. Toplam %100 olmalÄ±dÄ±r (YazÄ±/Tura iÃ§in).</p>
            
            <div id="weighted-inputs"></div>
            <div style="font-weight: bold; margin-top: 10px;">Toplam: <span id="weighted-total">0%</span></div>
            <div id="weighted-error" style="color: var(--danger); font-size: 0.9rem; min-height: 1.5em;"></div>

            <div class="control-grid">
                <button class="btn btn-primary" onclick="Game.logic.saveWeightedConfig()">AyarlarÄ± Kaydet ve BaÅŸlat</button>
                <button class="btn btn-secondary" onclick="document.getElementById('weighted-modal').classList.remove('open')">Ä°ptal</button>
            </div>
        </div>
    </div>

    <div id="ach-info-modal" class="modal-backdrop" onclick="if(event.target===this) document.getElementById('ach-info-modal').classList.remove('open')">
        <div class="modal-content">
            <h3 id="ach-title"></h3>
            <p id="ach-desc"></p>
            <p id="ach-reward"></p>
            <p id="ach-status"></p>
            <button class="btn btn-primary" style="width:100%; margin-top:10px;" onclick="document.getElementById('ach-info-modal').classList.remove('open')">Tamam</button>
        </div>
    </div>

    <script>
        /**
         * ====================================================================
         * GAME ENGINE V 4.1 - YÃœKSEK BAÅARIM VE KOZMETÄ°K GÃœNCELLEMESÄ°
         * BaÅŸarÄ±m sayÄ±sÄ± 1000+ hedeflendi.
         * Kozmetikler fiyata gÃ¶re sÄ±ralandÄ± ve yeni temalar eklendi.
         * ====================================================================
         */
        const Game = {
            state: {
                mode: 'NORMAL',
                outcomes: [],
                total: 0,
                streak: 0,
                bestStreak: 0,
                lastId: null,
                isAuto: false,
                autoLimit: 0,
                autoCount: 0,
                history: [],
                unlockedAchievements: [],
                weightedConfig: [], 
                customOutcomes: [],
                currency: 100, 
                inventory: ['default'],
                activeSkin: 'default',
                flipBonusLevel: 1, 
                flipBonus: 1, 
                flipSpeedLevel: 1, 
                flipDuration: 2,   
                luckyBonusLevel: 1, 
                longTermStats: { 
                    totalCurrencyEarned: 0, 
                    totalFlipWins: 0, 
                    totalFlipLosses: 0, 
                    modePlays: {},
                    luckyFlipsWon: 0,
                    auto100Completed: false,
                    auto1kCompleted: false,
                    totalFlipsMade: 0 
                }
            },
            
            defaults: {
                NORMAL: [
                    { id: 'n1', name: 'YazÄ±', emoji: 'âœï¸', color: '#ff7675', count: 0, weight: 50 },
                    { id: 'n2', name: 'Tura', emoji: 'ğŸ‘‘', color: '#00b894', count: 0, weight: 50 }
                ],
                SIMPLE: [
                    { id: 's1', name: 'Evet', emoji: 'âœ…', color: '#2ecc71', count: 0, weight: 50 },
                    { id: 's2', name: 'HayÄ±r', emoji: 'âŒ', color: '#e74c3c', count: 0, weight: 50 }
                ],
                DICE: [
                    { id: 'd1', name: '1', emoji: 'âš€', color: '#3498db', count: 0, weight: 16.66 },
                    { id: 'd2', name: '2', emoji: 'âš', color: '#3498db', count: 0, weight: 16.66 },
                    { id: 'd3', name: '3', emoji: 'âš‚', color: '#3498db', count: 0, weight: 16.66 },
                    { id: 'd4', name: '4', emoji: 'âšƒ', color: '#3498db', count: 0, weight: 16.66 },
                    { id: 'd5', name: '5', emoji: 'âš„', color: '#3498db', count: 0, weight: 16.66 },
                    { id: 'd6', name: '6', emoji: 'âš…', color: '#3498db', count: 0, weight: 16.66 } 
                ],
                RPS: [
                    { id: 'r1', name: 'TaÅŸ', emoji: 'âœŠ', color: '#95a5a6', count: 0, weight: 33.33 },
                    { id: 'r2', name: 'KaÄŸÄ±t', emoji: 'âœ‹', color: '#f1c40f', count: 0, weight: 33.33 },
                    { id: 'r3', name: 'Makas', emoji: 'âœŒï¸', color: '#3498db', count: 0, weight: 33.33 }
                ],
                CATEGORY: [ 
                    { id: 'cat1', name: 'Hayvan', emoji: 'ğŸ¾', color: '#f9ca24', count: 0, weight: 8.33 },
                    { id: 'cat2', name: 'Meyve', emoji: 'ğŸ', color: '#eb4d4b', count: 0, weight: 8.33 },
                    { id: 'cat3', name: 'TaÅŸÄ±t', emoji: 'ğŸš—', color: '#0fbcf9', count: 0, weight: 8.33 },
                    { id: 'cat4', name: 'Spor', emoji: 'âš½', color: '#1dd1a1', count: 0, weight: 8.33 },
                    { id: 'cat5', name: 'Renk', emoji: 'ğŸŒˆ', color: '#9d32d7', count: 0, weight: 8.33 },
                    { id: 'cat6', name: 'Ãœlke', emoji: 'ğŸ—ºï¸', color: '#f78c00', count: 0, weight: 8.33 },
                    { id: 'cat7', name: 'Hava', emoji: 'â˜ï¸', color: '#54a0ff', count: 0, weight: 8.33 },
                    { id: 'cat8', name: 'Gezegen', emoji: 'ğŸª', color: '#9c88ff', count: 0, weight: 8.33 },
                    { id: 'cat9', name: 'MÃ¼zik', emoji: 'ğŸ¶', color: '#ff6b81', count: 0, weight: 8.33 },
                    { id: 'cat10', name: 'Yemek', emoji: 'ğŸ”', color: '#2ecc71', count: 0, weight: 8.33 },
                    { id: 'cat11', name: 'Para', emoji: 'ğŸ’µ', color: '#f1c40f', count: 0, weight: 8.33 },
                    { id: 'cat12', name: 'Åans', emoji: 'ğŸ€', color: '#38ada9', count: 0, weight: 8.33 }
                ],
                CUSTOM: [] 
            },

            // Market YÃ¼kseltmeleri
            upgrades: {
                flipBonus: {
                    name: "ğŸ’° Jeton Ã‡arpanÄ±",
                    icon: "âœ¨",
                    baseCost: 50,
                    costMultiplier: 1.5,
                    maxLevel: 10,
                    effect: (level) => level, 
                    desc: (level) => `AtÄ±ÅŸ baÅŸÄ±na kazanÄ±lan jeton miktarÄ±nÄ± x${level} yapar.`
                },
                flipSpeed: { 
                    name: "âš¡ AtÄ±ÅŸ HÄ±zÄ±",
                    icon: "ğŸ’¨",
                    baseCost: 100,
                    costMultiplier: 2,
                    maxLevel: 4,
                    effect: (level) => {
                         const speeds = { 1: 2.0, 2: 1.5, 3: 1.0, 4: 0.5 };
                         return speeds[level];
                    }, 
                    desc: (level) => {
                        const nextSpeed = Game.upgrades.flipSpeed.effect(level + 1);
                        return `DÃ¶nÃ¼ÅŸ sÃ¼resini ${level} seviyesinde ${Game.upgrades.flipSpeed.effect(level)} saniyeye dÃ¼ÅŸÃ¼rÃ¼r. (Sonraki: ${nextSpeed || 'MAX'}s)`;
                    }
                },
                
                luckyBonus: {
                    name: "ğŸ€ Åans EtkinliÄŸi Jetonu",
                    icon: "ğŸŒŸ",
                    baseCost: 200,
                    costMultiplier: 1.8,
                    maxLevel: 10,
                    effect: (level) => 10 + (level * 10 * level), 
                    desc: (level) => `Åans EtkinliÄŸi (Lucky Flip) ile kazanÄ±lan ekstra jeton miktarÄ±nÄ± artÄ±rÄ±r. Mevcut Ekstra: ğŸ’° ${Game.upgrades.luckyBonus.effect(level)}`
                }
            },

            // Kozmetikler (Fiyata gÃ¶re sÄ±ralandÄ± ve yenileri eklendi)
            skins: [
                // Fiyat: 0 (BaÅŸlangÄ±Ã§ ve BaÅŸarÄ±m)
                { id: 'default', name: 'VarsayÄ±lan', emoji: 'ğŸª™', background: 'linear-gradient(135deg, #f1c40f 0%, #f39c12 100%)', color: '#fff', price: 0, unlocked: true, type: 'basic', theme: null },
                { id: 'lucky_charm', name: 'Åans TÄ±lsÄ±mÄ±', emoji: 'ğŸ€', background: 'linear-gradient(135deg, #1abc9c 0%, #16a085 100%)', color: '#fff', price: 0, unlocked: false, type: 'achievement', lockedBy: 'a36_lucky_win_10', theme: null },
                { id: 'streak_master', name: 'Seri Efendisi', emoji: 'ğŸ”±', background: 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)', color: '#fff', price: 0, unlocked: false, type: 'achievement', lockedBy: 'a60_streak_25', theme: null },
                { id: 'mode_explorer', name: 'Mod Gezgini', emoji: 'ğŸ§­', background: 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)', color: '#fff', price: 0, unlocked: false, type: 'achievement', lockedBy: 'a76_all_modes', theme: null },
                { id: 'coin_legend', name: 'Jeton Efsanesi', emoji: 'â­', background: 'linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)', color: '#fff', price: 0, unlocked: false, type: 'achievement', lockedBy: 'a90_richer_boy_max', theme: null },
                { id: 'galaxy_master', name: 'Galaksi UstasÄ±', emoji: 'ğŸŒŒ', background: 'linear-gradient(135deg, #7f8c8d 0%, #2c3e50 100%)', color: '#fff', price: 0, unlocked: false, type: 'achievement', lockedBy: 'a100_absolute_master', theme: {backgroundImage: 'linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url(https://picsum.photos/480/800?blur=5&random=1)', color: '#fff' } },

                // Fiyat: SatÄ±n AlÄ±nabilir
                { id: 'wood', name: 'Tahta', emoji: 'ğŸªµ', background: 'linear-gradient(135deg, #966f33 0%, #6f4e1f 100%)', color: '#fff', price: 50, unlocked: false, type: 'shop', theme: null },
                { id: 'gold', name: 'AltÄ±n', emoji: 'ğŸ†', background: 'linear-gradient(135deg, #ffd700 0%, #daa520 100%)', color: '#333', price: 200, unlocked: false, type: 'shop', theme: null },
                { id: 'space', name: 'Uzay TaÅŸÄ±', emoji: 'ğŸ‘½', background: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)', color: '#fff', price: 500, unlocked: false, type: 'shop', theme: null },
                { id: 'ruby', name: 'Yakut Zar', emoji: 'â™¦ï¸', background: 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)', color: '#fff', price: 1000, unlocked: false, type: 'shop', theme: null },
                { id: 'matrix', name: 'Matrix', emoji: 'ğŸ”¢', background: 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)', color: '#000', price: 1500, unlocked: false, type: 'shop', theme: null },
                { id: 'ocean', name: 'Okyanus', emoji: 'ğŸŒŠ', background: 'linear-gradient(135deg, #4dc3ff 0%, #3a8fe9 100%)', color: '#fff', price: 2500, unlocked: false, type: 'shop', theme: null },
                { id: 'ice', name: 'Buz', emoji: 'ğŸ§Š', background: 'linear-gradient(135deg, #d4f0ff 0%, #9bc9ff 100%)', color: '#333', price: 3000, unlocked: false, type: 'shop', theme: null },
                { id: 'lava', name: 'Lav', emoji: 'ğŸŒ‹', background: 'linear-gradient(135deg, #ff4500 0%, #ff8c00 100%)', color: '#333', price: 4000, unlocked: false, type: 'shop', theme: null },
                { id: 'nightsky', name: 'Gece GÃ¶kyÃ¼zÃ¼', emoji: 'ğŸŒŒ', background: 'linear-gradient(135deg, #1e002a 0%, #4a0050 100%)', color: '#a29bfe', price: 7500, unlocked: false, type: 'shop', theme: null },
                { id: 'rainbow', name: 'GÃ¶kkuÅŸaÄŸÄ±', emoji: 'ğŸŒˆ', background: 'linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet)', color: '#fff', price: 8000, unlocked: false, type: 'shop', theme: null },
                { id: 'hologram', name: 'Hologram', emoji: 'âœ¨', background: 'linear-gradient(135deg, #e3f2ff 0%, #c7e0ff 100%)', color: '#1e1e1e', price: 10000, unlocked: false, type: 'shop', theme: null },
                { id: 'fireball', name: 'AteÅŸ Topu', emoji: 'ğŸ’¥', background: 'linear-gradient(135deg, #ff5e00 0%, #e80e00 100%)', color: '#fff', price: 12000, unlocked: false, type: 'shop', theme: null },
                { id: 'neon', name: 'Neon IÅŸÄ±k', emoji: 'ğŸ’¡', background: 'linear-gradient(135deg, #00f260 0%, #0575e6 100%)', color: '#fff', price: 15000, unlocked: false, type: 'shop', theme: null },
                { id: 'alien', name: 'UzaylÄ±', emoji: 'ğŸ‘¾', background: 'linear-gradient(135deg, #4efd54 0%, #209c25 100%)', color: '#000', price: 18000, unlocked: false, type: 'shop', theme: null },
                { id: 'cyberpunk', name: 'Siber', emoji: 'ğŸ¤–', background: 'linear-gradient(135deg, #ff00c8 0%, #00ffd5 100%)', color: '#1e1e1e', price: 20000, unlocked: false, type: 'shop', theme: null },

                // Yeni YÃ¼ksek FiyatlÄ± Temalar (Arkaplan TemalÄ±)
                { id: 'star_dust', name: 'YÄ±ldÄ±z Tozu', emoji: 'ğŸ’«', background: 'linear-gradient(135deg, #2c3e50 0%, #1e2a38 100%)', color: '#fff', price: 50000, unlocked: false, type: 'shop', theme: { backgroundImage: 'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url(https://picsum.photos/480/800?blur=5&random=2)', color: '#a29bfe' } },
                { id: 'cosmic_ocean', name: 'Kozmik Okyanus', emoji: 'ğŸ§œâ€â™€ï¸', background: 'linear-gradient(135deg, #00008b 0%, #1e90ff 100%)', color: '#fff', price: 100000, unlocked: false, type: 'shop', theme: { backgroundImage: 'linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url(https://picsum.photos/480/800?blur=5&random=3)', color: '#4dc3ff' } },
                { id: 'dark_matter', name: 'KaranlÄ±k Madde', emoji: 'ğŸŒ‘', background: 'linear-gradient(135deg, #000000 0%, #1a1a1a 100%)', color: '#fff', price: 250000, unlocked: false, type: 'shop', theme: { backgroundColor: '#000000', color: '#fff' } },
            ],

            // 1000+ BaÅŸarÄ±m
            // BaÅŸarÄ±mlar mantÄ±ksal olarak artÄ±rÄ±ldÄ±.
            achievements: [
                // 1-100: TEMEL ATICILAR (10Milyona kadar)
                { id: 'a1_first_flip', icon: 'ğŸ£', title: 'Ä°lk AdÄ±m', desc: 'Ä°lk atÄ±ÅŸÄ±nÄ±zÄ± yapÄ±n.', check: (s) => s.total >= 1, reward: 10, category: 'Basic' },
                { id: 'a2_ten_flips', icon: 'ğŸ”Ÿ', title: 'Onluk', desc: 'Toplam 10 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 10, reward: 25, category: 'Basic' },
                { id: 'a3_century', icon: 'ğŸ’¯', title: 'AsÄ±rlÄ±k', desc: 'Toplam 100 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 100, reward: 100, category: 'Basic' },
                { id: 'a4_millennium', icon: 'ğŸ”¥', title: 'Bin AtÄ±ÅŸÃ§Ä±', desc: 'Toplam 1.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 1000, reward: 500, category: 'Basic' },
                { id: 'a5_master', icon: 'ğŸ‘‘', title: 'Usta (5K)', desc: 'Toplam 5.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 5000, reward: 1000, category: 'Basic' },
                { id: 'a6_grandmaster', icon: 'ğŸ†', title: 'BÃ¼yÃ¼k Usta (10K)', desc: 'Toplam 10.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 10000, reward: 2000, category: 'Basic' },
                { id: 'a7_immortal_25k', icon: 'âœ¨', title: 'Ã–lÃ¼msÃ¼z (25K)', desc: 'Toplam 25.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 25000, reward: 4000, category: 'Basic' },
                { id: 'a8_legend_50k', icon: 'ğŸŒŸ', title: 'Efsane (50K)', desc: 'Toplam 50.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 50000, reward: 8000, category: 'Basic' },
                { id: 'a9_cosmics_100k', icon: 'ğŸŒŒ', title: 'Kozmik (100K)', desc: 'Toplam 100.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 100000, reward: 15000, category: 'Basic' },
                { id: 'a10_super_cosmics_250k', icon: 'ğŸŒ ', title: 'SÃ¼per Kozmik (250K)', desc: 'Toplam 250.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 250000, reward: 25000, category: 'Basic' },
                { id: 'a11_mega_flips_500k', icon: 'ğŸ’¥', title: 'Mega AtÄ±ÅŸ (500K)', desc: 'Toplam 500.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 500000, reward: 35000, category: 'Basic' },
                { id: 'a12_million_flips', icon: 'ğŸ’°', title: 'Milyoner AtÄ±ÅŸÃ§Ä±', desc: 'Toplam 1.000.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 1000000, reward: 50000, category: 'Basic' },
                { id: 'a13_ten_million_flips', icon: 'â™¾ï¸', title: 'On Milyoncu', desc: 'Toplam 10.000.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 10000000, reward: 100000, category: 'Basic' },

                // 14-23: YÃ¼ksek Kazanma/Kaybetme BaÅŸarÄ±mlarÄ±
                { id: 'a14_wins_1k', icon: 'âœ”ï¸', title: 'Bin BaÅŸarÄ±lÄ± AtÄ±ÅŸ', desc: 'Toplam 1.000 baÅŸarÄ±lÄ± atÄ±ÅŸ yapÄ±n.', check: (s) => s.longTermStats.totalFlipWins >= 1000, reward: 500, category: 'Basic' },
                { id: 'a15_wins_10k', icon: 'ğŸ¯', title: 'On Bin BaÅŸarÄ±lÄ± AtÄ±ÅŸ', desc: 'Toplam 10.000 baÅŸarÄ±lÄ± atÄ±ÅŸ yapÄ±n.', check: (s) => s.longTermStats.totalFlipWins >= 10000, reward: 2000, category: 'Basic' },
                { id: 'a16_wins_100k', icon: 'ğŸ’¯', title: 'YÃ¼z Bin BaÅŸarÄ±lÄ±', desc: 'Toplam 100.000 baÅŸarÄ±lÄ± atÄ±ÅŸ yapÄ±n.', check: (s) => s.longTermStats.totalFlipWins >= 100000, reward: 15000, category: 'Basic' },
                { id: 'a17_wins_1m', icon: 'â­', title: 'Milyon BaÅŸarÄ±lÄ±', desc: 'Toplam 1.000.000 baÅŸarÄ±lÄ± atÄ±ÅŸ yapÄ±n.', check: (s) => s.longTermStats.totalFlipWins >= 1000000, reward: 50000, category: 'Basic' },
                { id: 'a18_losses_1k', icon: 'ğŸ’£', title: 'Bin Hata', desc: 'Toplam 1.000 kez seriyi kaybedin.', check: (s) => s.longTermStats.totalFlipLosses >= 1000, reward: 250, category: 'Basic' },
                { id: 'a19_losses_10k', icon: 'ğŸ’€', title: 'On Bin Hata', desc: 'Toplam 10.000 kez seriyi kaybedin.', check: (s) => s.longTermStats.totalFlipLosses >= 10000, reward: 1000, category: 'Basic' },

                // 20-30: SERÄ° (STREAK) BAÅARIMLARI
                { id: 'a20_streak_5', icon: '5ï¸âƒ£', title: 'Seri 5', desc: 'AynÄ± sonuca 5 kez Ã¼st Ã¼ste ulaÅŸÄ±n.', check: (s) => s.bestStreak >= 5, reward: 150, category: 'Streak' },
                { id: 'a21_streak_10', icon: 'ğŸ”Ÿ', title: 'Zincirleme', desc: 'AynÄ± sonuca 10 kez Ã¼st Ã¼ste ulaÅŸÄ±n.', check: (s) => s.bestStreak >= 10, reward: 500, category: 'Streak' },
                { id: 'a22_streak_20', icon: 'ğŸ§¨', title: 'BÃ¼yÃ¼k Zincir', desc: 'AynÄ± sonuca 20 kez Ã¼st Ã¼ste ulaÅŸÄ±n.', check: (s) => s.bestStreak >= 20, reward: 2500, category: 'Streak' },
                { id: 'a23_streak_50', icon: 'ğŸ‘‘', title: 'Maksimum Seri (50)', desc: 'AynÄ± sonuca 50 kez Ã¼st Ã¼ste ulaÅŸÄ±n.', check: (s) => s.bestStreak >= 50, reward: 15000, category: 'Streak' },
                { id: 'a24_streak_100', icon: 'â™¾ï¸', title: 'Efsanevi Seri (100)', desc: 'AynÄ± sonuca 100 kez Ã¼st Ã¼ste ulaÅŸÄ±n.', check: (s) => s.bestStreak >= 100, reward: 50000, category: 'Streak' },

                // 31-40: JETON & ÅANS BAÅARIMLARI (10Milyona kadar)
                { id: 'a31_rich_boy_10k', icon: 'ğŸ’°', title: 'Milyoner', desc: 'AnlÄ±k 10.000 Jeton biriktirin.', check: (s) => s.currency >= 10000, reward: 1000, category: 'Currency' },
                { id: 'a32_rich_boy_100k', icon: 'ğŸ¤‘', title: 'Patron', desc: 'AnlÄ±k 100.000 Jeton biriktirin.', check: (s) => s.currency >= 100000, reward: 5000, category: 'Currency' },
                { id: 'a33_rich_boy_1m', icon: 'ğŸ’', title: 'BÃ¼yÃ¼k Patron', desc: 'AnlÄ±k 1.000.000 Jeton biriktirin.', check: (s) => s.currency >= 1000000, reward: 20000, category: 'Currency' },
                { id: 'a34_rich_boy_10m', icon: 'ğŸ’²', title: 'Galaksi ZenginliÄŸi', desc: 'AnlÄ±k 10.000.000 Jeton biriktirin.', check: (s) => s.currency >= 10000000, reward: 100000, category: 'Currency' },
                { id: 'a35_lucky_win_100', icon: 'ğŸŒŸ', title: 'YÃ¼z ÅanslÄ± AtÄ±ÅŸ', desc: '100 kez Åans EtkinliÄŸini tetikleyin.', check: (s) => s.longTermStats.luckyFlipsWon >= 100, reward: 10000, category: 'Currency' },
                { id: 'a36_total_earned_1m', icon: 'ğŸ’¸', title: 'Kapitalist', desc: 'Toplam 1.000.000 Jeton kazanÄ±n.', check: (s) => s.longTermStats.totalCurrencyEarned >= 1000000, reward: 20000, category: 'Currency' },
                { id: 'a37_total_earned_10m', icon: 'ğŸ›ï¸', title: 'Merkez BankasÄ±', desc: 'Toplam 10.000.000 Jeton kazanÄ±n.', check: (s) => s.longTermStats.totalCurrencyEarned >= 10000000, reward: 50000, category: 'Currency' },

                // 41-50: YÃœKSELTME BAÅARIMLARI
                { id: 'a41_bonus_lvl_max', icon: 'ğŸ’¯', title: 'Maksimum Bonus', desc: 'Jeton Ã‡arpanÄ±nÄ± maksimum seviyeye (10) yÃ¼kseltin.', check: (s) => s.flipBonusLevel >= 10, reward: 5000, category: 'Upgrade' },
                { id: 'a42_speed_lvl_max', icon: 'âš¡', title: 'IÅŸÄ±k HÄ±zÄ±', desc: 'AtÄ±ÅŸ HÄ±zÄ± yÃ¼kseltmesini maksimum seviyeye (0.5s) yÃ¼kseltin.', check: (s) => s.flipSpeedLevel >= 4, reward: 1000, category: 'Upgrade' },
                { id: 'a43_lucky_lvl_max', icon: 'ğŸ’', title: 'Maksimum Åans', desc: 'Åans EtkinliÄŸi Jetonunu maksimum seviyeye (10) yÃ¼kseltin.', check: (s) => s.luckyBonusLevel >= 10, reward: 4000, category: 'Upgrade' },
                { id: 'a44_all_max', icon: 'ğŸ¥‡', title: 'YÃ¼kseltme UstasÄ±', desc: 'TÃ¼m yÃ¼kseltmeleri maksimum seviyeye getirin.', check: (s) => s.flipBonusLevel === 10 && s.flipSpeedLevel === 4 && s.luckyBonusLevel === 10, reward: 10000, category: 'Upgrade' },
                
                // 51-60: KOZMETÄ°K BAÅARIMLARI
                { id: 'a51_cosmetics_10', icon: 'ğŸ’', title: 'Onlu Koleksiyon', desc: '10 farklÄ± kozmetik Ã¼rÃ¼ne sahip olun.', check: (s) => Game.state.inventory.length >= 10, reward: 1500, category: 'Cosmetics' },
                { id: 'a52_cosmetics_half', icon: 'ğŸŒ“', title: 'YarÄ± Koleksiyoncu', desc: 'TÃ¼m kozmetiklerin yarÄ±sÄ±na sahip olun.', check: (s) => Game.state.inventory.length >= Math.floor(Game.skins.length / 2), reward: 5000, category: 'Cosmetics' },
                { id: 'a53_cosmetics_all', icon: 'ğŸŒˆ', title: 'Mutlak Koleksiyoncu', desc: 'TÃ¼m kozmetik Ã¼rÃ¼nlerini toplayÄ±n.', check: (s) => Game.state.inventory.length === Game.skins.length, reward: 25000, category: 'Cosmetics' },

                // 61-70: OTO-FLIP BAÅARIMLARI
                { id: 'a61_auto_10k', icon: 'ğŸ­', title: 'BÃ¼yÃ¼k Fabrika', desc: 'Tek seferde 10.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.total >= 10000 && s.longTermStats.auto1kCompleted === true, reward: 5000, category: 'Auto' },
                { id: 'a62_auto_total_10k', icon: 'ğŸ”„', title: 'Total Oto 10K', desc: 'Otomatik modda toplam 10.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.longTermStats.modePlays && Object.values(s.longTermStats.modePlays).reduce((a, b) => a + b, 0) >= 10000, reward: 7000, category: 'Auto' },
                
                // 71-80: MOD BAÅARIMLARI
                { id: 'a71_mode_master', icon: 'ğŸ•¹ï¸', title: 'ModlarÄ±n Efendisi', desc: 'TÃ¼m modlarda (7 mod) en az 1000 atÄ±ÅŸ yapÄ±n.', check: (s) => ['NORMAL', 'WEIGHTED', 'RPS', 'SIMPLE', 'DICE', 'CATEGORY', 'CUSTOM'].every(mode => s.longTermStats.modePlays[mode] >= 1000), reward: 10000, category: 'Modes' },
                
                // 91-100: MÄ°LESTONE & USTA BAÅARIMLARI
                { id: 'a91_flip_max_10k', icon: 'ğŸ’¯', title: 'Maksimum AtÄ±ÅŸ On Bin', desc: 'Jeton Ã‡arpanÄ± maksimum seviyedeyken 10.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.flipBonusLevel === 10 && s.total >= 10000, reward: 7500, category: 'Master' },
                { id: 'a92_autobot_master_100k', icon: 'ğŸ¤–', title: 'Robot Patron 100K', desc: 'Otomatik modda toplam 100.000 atÄ±ÅŸ yapÄ±n.', check: (s) => s.longTermStats.totalFlipsMade >= 100000 && s.longTermStats.auto1kCompleted === true, reward: 15000, category: 'Master' },
                { id: 'a100_absolute_master', icon: 'ğŸ¥‡', title: 'Mutlak Usta', desc: 'TÃ¼m 99 baÅŸarÄ±mlarÄ± tamamlayÄ±n. Ã–zel Kozmetik aÃ§ar.', check: (s) => s.unlockedAchievements.length >= 100, reward: 100000, category: 'Master', skinReward: 'galaxy_master' },
            ],

            // Kozmetikleri ID bazlÄ± eriÅŸim iÃ§in haritaya dÃ¶nÃ¼ÅŸtÃ¼r
            skinsMap: {},

            audio: { /* ... (DeÄŸiÅŸmedi) */
                ctx: null,
                init: function() {
                    if (!this.ctx) {
                        window.AudioContext = window.AudioContext || window.webkitAudioContext;
                        this.ctx = new AudioContext();
                    }
                    if (this.ctx.state === 'suspended') {
                        this.ctx.resume();
                    }
                },
                playTone: function(type) {
                    this.init();
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);

                    const now = this.ctx.currentTime;
                    
                    if (type === 'flip') {
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(150, now);
                        osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                        gain.gain.setValueAtTime(0.1, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                        osc.start(now);
                        osc.stop(now + 0.1);
                    } else if (type === 'win') {
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(500, now);
                        osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
                        gain.gain.setValueAtTime(0.2, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                        osc.start(now);
                        osc.stop(now + 0.3);
                    } else if (type === 'record') {
                        this.playTone('win');
                        setTimeout(() => this.playTone('win'), 100);
                    }
                }
            },

            data: {
                load: function() {
                    const saved = localStorage.getItem('CF_V2000_DATA'); 
                    const theme = localStorage.getItem('CF_V11_THEME');
                    
                    if (theme === 'dark') document.body.classList.add('dark-mode');

                    // skins dizisini, id'ye gÃ¶re hÄ±zlÄ± eriÅŸim iÃ§in haritaya dÃ¶nÃ¼ÅŸtÃ¼r
                    Game.skins.forEach(skin => {
                        Game.skinsMap[skin.id] = skin;
                    });


                    if (saved) {
                        const parsed = JSON.parse(saved);
                        
                        // Orijinal state.longTermStats yapÄ±sÄ±nÄ± korumak iÃ§in derin birleÅŸtirme
                        const defaultLongTermStats = Game.state.longTermStats;
                        const loadedLongTermStats = parsed.longTermStats || {};

                        Game.state = { 
                            ...Game.state, 
                            ...parsed, 
                            longTermStats: { 
                                ...defaultLongTermStats, // VarsayÄ±lan deÄŸerleri koru
                                ...loadedLongTermStats, // YÃ¼klÃ¼ deÄŸerleri Ã¼zerine yaz
                                modePlays: loadedLongTermStats.modePlays || {} // ModePlays'i Ã¶zel olarak ele al
                            },
                            flipBonusLevel: parsed.flipBonusLevel || 1, 
                            flipSpeedLevel: parsed.flipSpeedLevel || 1, 
                            luckyBonusLevel: parsed.luckyBonusLevel || 1, 
                            weightedConfig: parsed.weightedConfig || Game.state.weightedConfig,
                            customOutcomes: parsed.customOutcomes || Game.state.customOutcomes
                        };
                        
                        if (Game.state.customOutcomes.length > 0) {
                            Game.defaults['CUSTOM'] = Game.state.customOutcomes;
                        }

                        // YÃ¼kseltmeleri hesapla
                        Game.state.flipBonus = Game.upgrades.flipBonus.effect(Game.state.flipBonusLevel);
                        Game.state.flipDuration = Game.upgrades.flipSpeed.effect(Game.state.flipSpeedLevel);
                        Game.ui.updateFlipSpeed();

                        // Kozmetikleri yÃ¼kle
                        Game.skins.forEach(skin => {
                            skin.unlocked = Game.state.inventory.includes(skin.id);
                        });

                        if (Game.state.weightedConfig.length === 0) {
                             Game.state.weightedConfig = JSON.parse(JSON.stringify(Game.defaults['NORMAL']));
                        }
                        
                        let targetOutcomes = Game.defaults[Game.state.mode] || Game.defaults.NORMAL;
                        if (Game.state.mode === 'WEIGHTED') {
                             targetOutcomes = Game.state.weightedConfig;
                        } else if (Game.state.mode === 'CUSTOM') {
                            targetOutcomes = Game.state.customOutcomes.length > 0 ? Game.state.customOutcomes : Game.defaults.NORMAL;
                        }

                        Game.state.outcomes = targetOutcomes.map(def => {
                            const existing = parsed.outcomes ? parsed.outcomes.find(o => o.id === def.id) : null;
                            return { ...def, count: existing ? existing.count : 0 };
                        });

                        // Aktif skini tekrar uygulayÄ±n (theme Ã¶zelliÄŸi iÃ§in)
                        Game.ui.applySkinTheme(Game.state.activeSkin);
                        
                    } else {
                        Game.logic.setMode('NORMAL');
                        // Yeni kozmetikler iÃ§in de map oluÅŸmalÄ±
                        Game.skins.forEach(skin => {
                            Game.skinsMap[skin.id] = skin;
                        });
                    }
                    Game.ui.render();
                },
                save: function() {
                    localStorage.setItem('CF_V2000_DATA', JSON.stringify(Game.state));
                },
                exportData: function() {
                    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(Game.state));
                    const node = document.createElement('a');
                    node.setAttribute("href", dataStr);
                    node.setAttribute("download", "coin_flip_V410_backup.json");
                    document.body.appendChild(node);
                    node.click();
                    node.remove();
                },
                importData: function(input) {
                    const file = input.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            Game.state = { ...Game.state, ...data };
                            Game.data.save();
                            location.reload();
                        } catch(err) { alert("Dosya hatalÄ±!"); }
                    };
                    reader.readAsText(file);
                }
            },

            logic: {
                // ... (setMode, getWeightedResult, resetStats, saveCustomMode, saveWeightedConfig fonksiyonlarÄ± deÄŸiÅŸmedi)
                
                setMode: function(modeName) {
                    if (Game.state.isAuto) return alert("Otomatik atÄ±ÅŸ sÄ±rasÄ±nda mod deÄŸiÅŸtirilemez.");
                    
                    Game.state.mode = modeName;
                    
                    if (modeName === 'WEIGHTED') {
                        Game.state.outcomes = JSON.parse(JSON.stringify(Game.state.weightedConfig));
                    } else if (modeName === 'CUSTOM') {
                         if (Game.state.customOutcomes.length === 0) {
                            alert("Ã–zel mod ayarlanmamÄ±ÅŸ. VarsayÄ±lan moda dÃ¶nÃ¼lÃ¼yor.");
                            Game.logic.setMode('NORMAL');
                            return;
                         }
                         Game.state.outcomes = JSON.parse(JSON.stringify(Game.state.customOutcomes));
                    } else if (Game.defaults[modeName]) {
                        Game.state.outcomes = JSON.parse(JSON.stringify(Game.defaults[modeName]));
                    } else {
                        Game.logic.setMode('NORMAL');
                        return;
                    }
                    
                    Game.state.outcomes.forEach(o => o.count = 0);
                    Game.state.total = 0;
                    Game.state.streak = 0;
                    Game.state.lastId = null;
                    
                    Game.ui.initializeCoinVisuals(modeName);
                    
                    Game.data.save();
                    Game.ui.render();
                    Game.ui.toggleMenu(false); 
                },

                getWeightedResult: function() {
                    const totalWeight = Game.state.outcomes.reduce((sum, o) => sum + o.weight, 0);
                    let rand = Math.random() * totalWeight;

                    for (const outcome of Game.state.outcomes) {
                        if (rand < outcome.weight) {
                            return outcome;
                        }
                        rand -= outcome.weight;
                    }
                    return Game.state.outcomes[Game.state.outcomes.length - 1];
                },

                flip: function() {
                    const coinEl = document.getElementById('coin');
                    if (coinEl.classList.contains('is-flipping')) return;

                    Game.audio.playTone('flip');

                    coinEl.textContent = '...';
                    coinEl.classList.add('is-flipping');
                    document.getElementById('result-text').textContent = "DÃ¶nÃ¼yor...";
                    
                    if (!Game.state.isAuto) Game.ui.setControls(false); 

                    let winner;
                    if (Game.state.mode === 'WEIGHTED' || Game.state.mode === 'CUSTOM') {
                        winner = Game.logic.getWeightedResult(); 
                    } else {
                        const winnerIndex = Math.floor(Math.random() * Game.state.outcomes.length);
                        winner = Game.state.outcomes[winnerIndex];
                    }

                    setTimeout(() => {
                        coinEl.classList.remove('is-flipping');
                        
                        // Ä°statistikleri gÃ¼ncelle
                        const winnerIndex = Game.state.outcomes.findIndex(o => o.id === winner.id);
                        if(winnerIndex !== -1) Game.state.outcomes[winnerIndex].count++;
                        Game.state.total++;
                        Game.state.longTermStats.totalFlipsMade = Game.state.total; 
                        
                        Game.state.longTermStats.modePlays = Game.state.longTermStats.modePlays || {};
                        Game.state.longTermStats.modePlays[Game.state.mode] = (Game.state.longTermStats.modePlays[Game.state.mode] || 0) + 1;
                        
                        // --- SERÄ° VE JETON MANTIK KISMI ---
                        const baseGain = 1;
                        let totalCurrencyGain = 0;
                        let streakBonus = 0;
                        let isRecord = false;
                        let luckyBonus = 0;
                        let luckyEventGain = 0;
                        let messageColor = 'transparent';
                        let messageText = '';

                        // AÄŸÄ±rlÄ±klÄ± Modda (WEIGHTED) Seri ve Åans Bonusu yok. Sadece Temel Jeton Ã‡arpanÄ± Ã§alÄ±ÅŸÄ±r.
                        const isWeightedMode = Game.state.mode === 'WEIGHTED';
                        
                        if (!isWeightedMode) {
                            if (Game.state.lastId === winner.id) {
                                Game.state.streak++;
                                Game.state.longTermStats.totalFlipWins++; 
                            } else {
                                Game.state.streak = 1; 
                                Game.state.longTermStats.totalFlipLosses++; 
                            }
                            Game.state.lastId = winner.id; 
                            
                            if (Game.state.streak >= 2) {
                                // Seri Ã–dÃ¼l FormÃ¼lÃ¼
                                streakBonus = (Game.state.streak - 1) * baseGain * Game.state.flipBonus * Game.state.streak;
                            }
                        } else {
                            // AÄŸÄ±rlÄ±klÄ± Modda Seri KÄ±rÄ±lÄ±r/SÄ±fÄ±rlanÄ±r
                            Game.state.streak = 0;
                            Game.state.lastId = null;
                        }

                        const regularGain = baseGain * Game.state.flipBonus;

                        if (!isWeightedMode && Math.random() < 0.05) { 
                            const calculatedLuckyReward = Game.upgrades.luckyBonus.effect(Game.state.luckyBonusLevel); 
                            const baseLuckyReward = 4;
                            
                            luckyEventGain = baseLuckyReward * Game.state.flipBonus; 
                            luckyBonus = calculatedLuckyReward;

                            totalCurrencyGain = regularGain + streakBonus + luckyEventGain + luckyBonus;

                            Game.state.longTermStats.luckyFlipsWon++; 
                            messageColor = 'var(--accent)';
                            messageText = `ğŸ’¥ ÅANS ETKÄ°NLÄ°ÄÄ°! +${regularGain + luckyEventGain} Jeton (Temel) + ${streakBonus} Jeton (Seri) + ${luckyBonus} Ekstra Jeton!`;

                        } else {
                            totalCurrencyGain = regularGain + streakBonus;

                            if (Game.state.mode === 'WEIGHTED') {
                                messageText = `âš–ï¸ AÄŸÄ±rlÄ±klÄ± Mod | +${totalCurrencyGain} Jeton (Temel Ã‡arpan x${Game.state.flipBonus})`;
                                messageColor = 'var(--secondary)'; 
                            } else if (Game.state.streak >= 2) {
                                messageText = `ğŸ”¥ Seri x${Game.state.streak} | +${regularGain} Jeton (Temel) + ${streakBonus} Jeton (Seri) = Toplam +${totalCurrencyGain} Jeton!`;
                                messageColor = 'var(--warning)';
                            } else {
                                messageText = `+${totalCurrencyGain} Jeton KazanÄ±ldÄ±! (x${Game.state.flipBonus})`;
                                messageColor = 'transparent';
                            }
                        }

                        Game.state.currency += totalCurrencyGain;
                        Game.state.longTermStats.totalCurrencyEarned += totalCurrencyGain;
                        
                        document.getElementById('flip-message').style.backgroundColor = messageColor;
                        document.getElementById('flip-message').textContent = messageText;
                        document.getElementById('flip-message').style.display = 'block';
                        setTimeout(() => {
                            document.getElementById('flip-message').style.display = 'none';
                            document.getElementById('flip-message').style.backgroundColor = 'transparent'; 
                        }, Game.state.flipDuration * 1000 + 50);

                        if (Game.state.streak > Game.state.bestStreak) {
                            Game.state.bestStreak = Game.state.streak;
                            isRecord = true;
                        }
                        // --- SERÄ° VE JETON MANTIK KISMI BÄ°TÄ°ÅÄ° ---


                        Game.ui.updateResult(winner, isRecord);
                        Game.ui.renderStats(); 
                        Game.logic.checkAchievements();
                        Game.data.save();

                        Game.audio.playTone(isRecord ? 'record' : 'win');
                        Game.ui.fireConfetti(winner.color);
                        Game.ui.renderHeader(); 

                        // OTOMATÄ°K KONTROL
                        if (Game.state.isAuto) {
                            Game.state.autoCount++; 
                            
                            if (Game.state.autoLimit === 999999) {
                                if (Game.state.autoCount === 100) Game.state.longTermStats.auto100Completed = true;
                                if (Game.state.autoCount === 1000) Game.state.longTermStats.auto1kCompleted = true; 
                            } else if (Game.state.autoCount >= Game.state.autoLimit) {
                                if (Game.state.autoLimit === 100) Game.state.longTermStats.auto100Completed = true;
                                if (Game.state.autoLimit === 1000) Game.state.longTermStats.auto1kCompleted = true;
                                
                                Game.logic.toggleAuto(); 
                                document.getElementById('result-text').textContent = `${Game.state.autoCount} AtÄ±ÅŸ TamamlandÄ±!`;
                                Game.logic.checkAchievements(); 
                            } 
                        } else {
                            Game.ui.setControls(true);
                        }

                    }, Game.state.flipDuration * 1000); 
                },

                toggleAuto: function() {
                    const btn = document.getElementById('btn-auto');
                    const limitSelect = document.getElementById('auto-limit');

                    if (Game.state.isAuto) {
                        Game.state.isAuto = false;
                        clearInterval(Game.autoInterval); 
                        btn.textContent = 'ğŸš€ Otomatik';
                        btn.classList.replace('btn-primary', 'btn-secondary');
                        Game.ui.setControls(true);
                        limitSelect.disabled = false;
                    } else {
                        Game.state.isAuto = true;
                        Game.state.autoLimit = parseInt(limitSelect.value);
                        Game.state.autoCount = 0;
                        
                        // 1k ve 10k seÃ§enekleri eklendi
                        if (Game.state.autoLimit === 100) Game.state.longTermStats.auto100Completed = true;
                        if (Game.state.autoLimit === 1000) Game.state.longTermStats.auto1kCompleted = true;
                        
                        btn.textContent = 'ğŸ›‘ Durdur';
                        btn.classList.replace('btn-secondary', 'btn-primary');
                        Game.ui.setControls(false); 
                        limitSelect.disabled = true;

                        Game.logic.flip();
                        
                        Game.autoInterval = setInterval(() => {
                            if (!document.getElementById('coin').classList.contains('is-flipping') && Game.state.isAuto) {
                                Game.logic.flip();
                            } else if (!Game.state.isAuto) {
                                clearInterval(Game.autoInterval);
                            }
                        }, Game.state.flipDuration * 1000 + 50); 
                    }
                },

                resetStats: function() {
                    if (confirm('TÃ¼m istatistikleri sÄ±fÄ±rlamak istiyor musunuz? (Jetonlar ve YÃ¼kseltmeler korunur)')) {
                        Game.state.outcomes.forEach(o => o.count = 0);
                        Game.state.total = 0;
                        Game.state.streak = 0;
                        Game.state.bestStreak = 0;
                        Game.state.lastId = null;
                        Game.data.save();
                        Game.ui.render();
                    }
                },
                
                hardReset: function() {
                    if (confirm('ğŸš¨ DÄ°KKAT! Bu iÅŸlem tÃ¼m ilerlemenizi, jetonlarÄ±nÄ±zÄ±, baÅŸarÄ±mlarÄ±nÄ±zÄ± ve yÃ¼kseltmelerinizi sÄ±fÄ±rlayacaktÄ±r. Emin misiniz?')) {
                        localStorage.removeItem('CF_V2000_DATA'); 
                        alert('Hesap baÅŸarÄ±yla sÄ±fÄ±rlandÄ±. Oyun yeniden baÅŸlatÄ±lÄ±yor...');
                        location.reload(); 
                    }
                },

                checkAchievements: function() {
                    let changed = false;
                    Game.achievements.forEach(ach => {
                        if (!Game.state.unlockedAchievements.includes(ach.id) && ach.check(Game.state)) {
                            Game.state.unlockedAchievements.push(ach.id);
                            
                            Game.state.currency += ach.reward || 0;
                            Game.state.longTermStats.totalCurrencyEarned += ach.reward || 0;

                            if (ach.skinReward) {
                                if (!Game.state.inventory.includes(ach.skinReward)) {
                                     Game.state.inventory.push(ach.skinReward);
                                     Game.skinsMap[ach.skinReward].unlocked = true;
                                     alert(`ğŸ† Ã–ZEL KOZMETÄ°K AÃ‡ILDI: ${Game.skinsMap[ach.skinReward].name} (${Game.skinsMap[ach.skinReward].emoji})!`);
                                }
                            }

                            Game.ui.renderHeader(); 
                            alert(`ğŸ† BAÅARIM AÃ‡ILDI: ${ach.title} (ğŸ’° ${ach.reward} Jeton)`); 
                            changed = true;
                        }
                    });
                    if(changed) Game.ui.renderAchievements();
                },
                
                saveCustomMode: function() {
                    const inputs = document.querySelectorAll('#custom-inputs > .input-group');
                    if (inputs.length < 2) {
                        alert("En az 2 sonuÃ§ tanÄ±mlamalÄ±sÄ±nÄ±z.");
                        return;
                    }
                    
                    const newOutcomes = [];
                    let hasError = false;
                    
                    inputs.forEach((group, index) => {
                        const name = group.querySelector(`#custom-name-${index}`).value.trim();
                        const emoji = group.querySelector(`#custom-emoji-${index}`).value.trim() || 'â“';
                        const color = group.querySelector(`#custom-color-${index}`).value;
                        
                        if (name === "") {
                            alert("TÃ¼m sonuÃ§lara isim vermelisiniz.");
                            hasError = true;
                            return;
                        }
                        
                        newOutcomes.push({
                            id: 'c' + (index + 1),
                            name: name,
                            emoji: emoji,
                            color: color,
                            count: 0,
                            weight: 100 / inputs.length
                        });
                    });
                    
                    if (hasError) return;

                    Game.state.customOutcomes = newOutcomes;
                    Game.defaults['CUSTOM'] = newOutcomes;
                    
                    Game.data.save();
                    document.getElementById('custom-modal').classList.remove('open');
                    Game.logic.setMode('CUSTOM');
                },

                saveWeightedConfig: function() {
                    const inputs = document.querySelectorAll('#weighted-inputs input[type="number"]');
                    let total = 0;
                    
                    inputs.forEach(input => {
                        total += parseFloat(input.value) || 0;
                    });

                    if (Math.abs(total - 100) > 0.01) {
                        alert(`Hata: Toplam aÄŸÄ±rlÄ±k tam 100% olmalÄ±dÄ±r! Åu an: ${total.toFixed(2)}%`);
                        return;
                    }
                    
                    Game.state.weightedConfig = Game.state.weightedConfig.map((o, index) => {
                        const inputEl = document.getElementById(`weight-${index}`);
                        o.weight = parseFloat(inputEl.value);
                        o.name = inputEl.parentNode.querySelector('input[type="text"]').value; // Ä°sim alanÄ±nÄ± da gÃ¼ncelleyelim
                        return o;
                    });
                    
                    Game.data.save();
                    document.getElementById('weighted-modal').classList.remove('open');
                    Game.logic.setMode('WEIGHTED');
                }
            },

            shop: {
                
                buyUpgrade: function(upgradeId) {
                    const upgrade = Game.upgrades[upgradeId];
                    let currentLevel = 0;

                    if (upgradeId === 'flipBonus') {
                        currentLevel = Game.state.flipBonusLevel;
                    } else if (upgradeId === 'flipSpeed') {
                        currentLevel = Game.state.flipSpeedLevel;
                    } else if (upgradeId === 'luckyBonus') {
                        currentLevel = Game.state.luckyBonusLevel;
                    }

                    if (currentLevel >= upgrade.maxLevel) {
                        alert("Bu yÃ¼kseltme zaten maksimum seviyede.");
                        return;
                    }

                    const cost = Math.ceil(upgrade.baseCost * Math.pow(upgrade.costMultiplier, currentLevel));
                    
                    if (Game.state.currency >= cost) {
                        Game.state.currency -= cost;
                        
                        if (upgradeId === 'flipBonus') {
                            Game.state.flipBonusLevel++;
                            Game.state.flipBonus = upgrade.effect(Game.state.flipBonusLevel);
                        } else if (upgradeId === 'flipSpeed') {
                            Game.state.flipSpeedLevel++;
                            Game.state.flipDuration = upgrade.effect(Game.state.flipSpeedLevel);
                            Game.ui.updateFlipSpeed(); 
                        } else if (upgradeId === 'luckyBonus') {
                            Game.state.luckyBonusLevel++;
                        }
                        
                        Game.data.save();
                        Game.ui.renderHeader();
                        Game.shop.renderShop();
                        Game.logic.checkAchievements();
                        alert(`${upgrade.name} seviye ${currentLevel + 1} baÅŸarÄ±yla satÄ±n alÄ±ndÄ±!`);
                    } else {
                        alert(`Yeterli Jeton yok! ${cost - Game.state.currency} Jeton daha lazÄ±m.`);
                    }
                },

                buySkin: function(skinId) {
                    const skin = Game.skinsMap[skinId];
                    if (Game.state.inventory.includes(skinId)) {
                        Game.shop.equipSkin(skinId);
                        return;
                    }
                    
                    // BaÅŸarÄ±mla aÃ§Ä±lan skinler satÄ±n alÄ±namaz
                    if (skin.type === 'achievement') {
                         alert("Bu kozmetik, bir baÅŸarÄ±mla aÃ§Ä±lmalÄ±dÄ±r!");
                         return;
                    }


                    if (Game.state.currency >= skin.price) {
                        if (confirm(`${skin.name} (${skin.emoji}) kozmetiÄŸini ${skin.price} jeton karÅŸÄ±lÄ±ÄŸÄ±nda satÄ±n almak istiyor musunuz?`)) {
                            Game.state.currency -= skin.price;
                            Game.state.inventory.push(skinId);
                            skin.unlocked = true;
                            Game.shop.equipSkin(skinId);
                            Game.data.save();
                            Game.ui.renderHeader();
                            Game.shop.renderShop();
                            Game.logic.checkAchievements();
                        }
                    } else {
                        alert(`Yeterli Jeton yok! ${skin.price - Game.state.currency} Jeton daha lazÄ±m.`);
                    }
                },
                
                equipSkin: function(skinId) {
                    Game.state.activeSkin = skinId;
                    Game.data.save();
                    Game.shop.renderShop();
                    Game.ui.initializeCoinVisuals(Game.state.mode);
                    Game.ui.applySkinTheme(skinId); // Yeni: Tema uygulandÄ±.
                    alert(`${Game.skinsMap[skinId].name} donatÄ±ldÄ±.`);
                },

                renderShop: function() {
                    const currencyDisplay = document.getElementById('shop-currency-display');
                    currencyDisplay.textContent = `Mevcut Jeton: ğŸ’° ${Game.state.currency}`;
                    Game.shop.renderUpgrades();
                    Game.shop.renderSkins();
                },

                renderUpgrades: function() {
                    const container = document.getElementById('upgrade-section');
                    container.innerHTML = '';
                    
                    Object.keys(Game.upgrades).forEach(upgradeId => {
                        const upgrade = Game.upgrades[upgradeId];
                        
                        let currentLevel = 0;
                        if (upgradeId === 'flipBonus') currentLevel = Game.state.flipBonusLevel;
                        else if (upgradeId === 'flipSpeed') currentLevel = Game.state.flipSpeedLevel;
                        else if (upgradeId === 'luckyBonus') currentLevel = Game.state.luckyBonusLevel;
                        
                        let cost;
                        const maxed = currentLevel >= upgrade.maxLevel;
                        
                        if (maxed) {
                            cost = 0;
                        } else {
                             cost = Math.ceil(upgrade.baseCost * Math.pow(upgrade.costMultiplier, currentLevel)); 
                        }

                        const descText = upgrade.desc(currentLevel); 
                        
                        const buttonHTML = maxed 
                            ? `<button class="btn btn-secondary" disabled>Max Seviye</button>`
                            : `<button class="btn btn-primary" onclick="Game.shop.buyUpgrade('${upgradeId}')">ğŸ’° ${cost}</button>`;

                        container.innerHTML += `
                            <div class="upgrade-card">
                                <div class="upgrade-info">
                                    <div>
                                        <h4>${upgrade.icon} ${upgrade.name}</h4>
                                        <p class="upgrade-desc">${descText}</p>
                                    </div>
                                    <div class="upgrade-level">
                                        Seviye: ${currentLevel} / ${upgrade.maxLevel}
                                    </div>
                                </div>
                                ${buttonHTML}
                            </div>
                        `;
                    });
                },

                renderSkins: function() {
                    const container = document.getElementById('shop-items-grid');
                    container.innerHTML = '';

                    // Kozmetikler fiyata gÃ¶re sÄ±ralanmÄ±ÅŸ diziden alÄ±nÄ±r.
                    Game.skins.forEach(skin => {
                        const skinId = skin.id;
                        const isUnlocked = Game.state.inventory.includes(skinId);
                        const isEquipped = Game.state.activeSkin === skinId;
                        
                        let buttonHTML;
                        if (isEquipped) {
                            buttonHTML = `<button class="btn btn-primary" disabled>DonatÄ±ldÄ±</button>`;
                        } else if (isUnlocked) {
                            buttonHTML = `<button class="btn btn-secondary" onclick="Game.shop.equipSkin('${skinId}')">Donat</button>`;
                        } else if (skin.type === 'achievement') {
                             buttonHTML = `<button class="btn btn-secondary" disabled>ğŸ† BaÅŸarÄ±mla AÃ§Ä±lÄ±r</button>`;
                        } else {
                            buttonHTML = `<button class="btn btn-primary" onclick="Game.shop.buySkin('${skinId}')">ğŸ’° ${skin.price}</button>`;
                        }

                        container.innerHTML += `
                            <div class="shop-item ${isEquipped ? 'equipped' : ''}" style="border: 2px solid ${isEquipped ? 'var(--accent)' : 'transparent'}">
                                <span class="shop-item-icon">${skin.emoji}</span>
                                <h4>${skin.name}</h4>
                                ${isUnlocked ? '<p style="color:var(--accent); font-weight:700;">AÃ§Ä±k</p>' : (skin.type === 'achievement' ? '<p style="color:var(--danger); font-weight:700;">Kilitli</p>' : `<p class="shop-price">ğŸ’° ${skin.price}</p>`)}
                                ${buttonHTML}
                            </div>
                        `;
                    });
                }
            },

            analyst: {
                // ... (Analiz fonksiyonlarÄ± deÄŸiÅŸmedi)
                
                calculatePrediction: function() {
                    let totalFlips = Game.state.outcomes.reduce((sum, o) => sum + o.count, 0);
                    if (totalFlips < 20) return "Analist: Yeterli veri yok. AtÄ±ÅŸ yapmaya devam edin.";

                    let lowestOutcome = Game.state.outcomes.reduce((min, o) => o.count < min.count ? o : min, { count: Infinity });
                    let highestOutcome = Game.state.outcomes.reduce((max, o) => o.count > max.count ? o : max, { count: -Infinity });

                    if (highestOutcome.count - lowestOutcome.count > totalFlips * 0.1) {
                         return `Analist: Ä°statistiksel sapma var! Bir sonraki atÄ±ÅŸÄ±nÄ±zÄ±n **${lowestOutcome.name} (${lowestOutcome.emoji})** gelme olasÄ±lÄ±ÄŸÄ± istatistiksel olarak daha yÃ¼ksektir.`;
                    } else {
                         return "Analist: Ä°statistikler dengede gÃ¶rÃ¼nÃ¼yor. AtÄ±ÅŸÄ±nÄ±z %50 ÅŸansla devam edecektir. ÅansÄ±nÄ±z bol olsun!";
                    }
                },

                renderAnalyst: function() {
                    const luckyExtra = Game.upgrades.luckyBonus.effect(Game.state.luckyBonusLevel);
                    const longStats = document.getElementById('analyst-long-stats');
                    longStats.innerHTML = `
                        <div class="stat-row"><span>Toplam KazanÄ±lan Jeton:</span> <span>ğŸ’° ${Game.state.longTermStats.totalCurrencyEarned}</span></div>
                        <div class="stat-row"><span>Mevcut Jeton Ã‡arpanÄ±:</span> <span>x${Game.state.flipBonus}</span></div>
                        <div class="stat-row"><span>Åans EtkinliÄŸi Ekstra:</span> <span>ğŸ’° ${luckyExtra}</span></div>
                        <div class="stat-row"><span>AtÄ±ÅŸ HÄ±zÄ± SÃ¼resi:</span> <span>${Game.state.flipDuration}s</span></div>
                        <div class="stat-row"><span>Toplam BaÅŸarÄ±mlar:</span> <span>ğŸ† ${Game.state.unlockedAchievements.length} / ${Game.achievements.length}</span></div>
                    `;
                    
                    document.getElementById('analyst-prediction').textContent = Game.analyst.calculatePrediction();
                }
            },

            ui: {
                
                renderHeader: function() {
                    document.getElementById('currency-display').textContent = `ğŸ’° ${Game.state.currency}`;
                },
                
                updateFlipSpeed: function() {
                    const body = document.getElementById('game-body');
                    body.style.setProperty('--flip-duration', `${Game.state.flipDuration}s`);
                },

                toggleMenu: function(forceState) {
                    const modal = document.getElementById('main-menu-modal');
                    if (forceState === false) modal.classList.remove('open');
                    else modal.classList.toggle('open');
                },
                
                openShopModal: function() {
                    Game.shop.renderShop();
                    document.getElementById('shop-modal').classList.add('open');
                },
                openAnalystModal: function() {
                    Game.analyst.renderAnalyst();
                    document.getElementById('analyst-modal').classList.add('open');
                },

                renderStats: function() {
                    const container = document.getElementById('stats-container');
                    const totalFlipsEl = document.getElementById('total-flips');
                    const bestStreakEl = document.getElementById('best-streak');
                    const modeNameEl = document.getElementById('mode-name-display');

                    container.innerHTML = '';
                    
                    modeNameEl.textContent = Game.state.mode === 'NORMAL' ? 'Normal' : 
                                             Game.state.mode === 'WEIGHTED' ? 'AÄŸÄ±rlÄ±klÄ±' :
                                             Game.state.mode === 'CUSTOM' ? 'Ã–zel' :
                                             Game.state.mode === 'RPS' ? 'TaÅŸ-KaÄŸÄ±t-Makas' :
                                             Game.state.mode === 'DICE' ? 'Zar' :
                                             Game.state.mode === 'SIMPLE' ? 'Basit' :
                                             Game.state.mode === 'CATEGORY' ? 'Kategori' : Game.state.mode;

                    if (Game.state.total === 0) {
                        container.innerHTML = `<p style="text-align:center; color:var(--text-muted);">HenÃ¼z atÄ±ÅŸ yapÄ±lmadÄ±. Ä°statistikler burada gÃ¶rÃ¼necek.</p>`;
                        totalFlipsEl.textContent = 0;
                        bestStreakEl.textContent = 0;
                        return;
                    }

                    Game.state.outcomes.forEach(o => {
                        const percent = Game.state.total > 0 ? ((o.count / Game.state.total) * 100).toFixed(1) : 0;
                        const statRow = document.createElement('div');
                        statRow.className = 'stat-row';
                        statRow.innerHTML = `
                            <span>${o.emoji} ${o.name} (${o.count})</span>
                            <div class="stat-bar-wrapper">
                                <div class="stat-bar" style="width: ${percent}%; background-color: ${o.color};"></div>
                            </div>
                            <span>${percent}%</span>
                        `;
                        container.appendChild(statRow);
                    });

                    totalFlipsEl.textContent = Game.state.total;
                    bestStreakEl.textContent = Game.state.bestStreak;
                },

                setControls: function(enabled) {
                    document.getElementById('btn-flip').disabled = !enabled;
                    document.getElementById('btn-reset').disabled = !enabled;
                },
                
                initializeCoinVisuals: function(modeName) {
                    const coinEl = document.getElementById('coin');
                    const currentSkinId = Game.state.activeSkin;
                    const skin = Game.skinsMap[currentSkinId];
                    
                    if (currentSkinId === 'default' && Game.defaults[modeName]) {
                        coinEl.style.background = Game.skinsMap['default'].background;
                        coinEl.style.color = Game.skinsMap['default'].color;
                        coinEl.textContent = Game.skinsMap['default'].emoji;
                    } else if (skin) {
                         coinEl.style.background = skin.background;
                         coinEl.style.color = skin.color;
                         coinEl.textContent = skin.emoji; 
                    }
                    
                    document.getElementById('result-text').textContent = "AtÄ±ÅŸ Yapmaya HazÄ±r!";
                    const streakBadge = document.getElementById('streak-badge');
                    streakBadge.style.display = 'none';
                },
                
                updateResult: function(winner, isRecord) {
                    const coinEl = document.getElementById('coin');
                    let skin = Game.skinsMap[Game.state.activeSkin];
                    
                    if (Game.state.activeSkin === 'default') {
                        coinEl.style.background = winner.color;
                        coinEl.style.color = '#fff'; 
                        coinEl.textContent = winner.emoji;

                    } else if (skin) {
                         coinEl.style.background = skin.background;
                         coinEl.style.color = skin.color;
                         coinEl.textContent = winner.emoji || skin.emoji; 
                    } 
                    
                    document.getElementById('result-text').textContent = `${winner.name} Geldi!`;

                    const streakBadge = document.getElementById('streak-badge');
                    // AÄŸÄ±rlÄ±klÄ± modda seriyi gÃ¶sterme
                    if (Game.state.streak > 1 && Game.state.mode !== 'WEIGHTED') {
                        streakBadge.style.display = 'flex';
                        streakBadge.textContent = `ğŸ”¥ ${Game.state.streak}`;
                        document.getElementById('result-text').textContent += ` (${Game.state.streak} Seri!)`;
                    } else {
                         streakBadge.style.display = 'none';
                    }
                    
                    if (isRecord && Game.state.mode !== 'WEIGHTED') {
                        document.getElementById('result-text').textContent += ` - YENÄ° REKOR!`;
                    }
                },


                renderAchievements: function() {
                    const container = document.getElementById('achievements-list');
                    const totalAchCount = document.getElementById('total-achievements-count');
                    const unlockedAchCount = document.getElementById('unlocked-achievements-count');
                    
                    container.innerHTML = '';
                    
                    totalAchCount.textContent = Game.achievements.length;
                    unlockedAchCount.textContent = Game.state.unlockedAchievements.length;

                    Game.achievements.forEach(ach => {
                        const isUnlocked = Game.state.unlockedAchievements.includes(ach.id);
                        const iconClass = ach.skinReward ? 'skin-reward' : '';

                        container.innerHTML += `
                            <div class="achievement-item ${isUnlocked ? 'unlocked' : ''}" 
                                onclick="Game.ui.openAchInfoModal('${ach.id}')">
                                <span class="ach-icon ${iconClass}">${ach.icon}</span>
                            </div>
                        `;
                    });
                },

                openAchInfoModal: function(achId) {
                    const ach = Game.achievements.find(a => a.id === achId);
                    const isUnlocked = Game.state.unlockedAchievements.includes(achId);
                    
                    document.getElementById('ach-title').textContent = ach.icon + " " + ach.title;
                    document.getElementById('ach-desc').textContent = ach.desc;
                    
                    let rewardText = `Ã–dÃ¼l: ğŸ’° ${ach.reward} Jeton`;
                    let statusText = 'Kilidi aÃ§mak iÃ§in gereklilikleri tamamlayÄ±n.';

                    if (ach.skinReward) {
                        const skin = Game.skinsMap[ach.skinReward];
                        rewardText += ` + Ã–ZEL KOZMETÄ°K: ${skin.name} ${skin.emoji}`;
                    }

                    if (isUnlocked) {
                        rewardText = `âœ… BaÅŸarÄ±mÄ± AÃ§tÄ±nÄ±z! KazanÄ±lan: ğŸ’° ${ach.reward} Jeton` + (ach.skinReward ? ` + ${Game.skinsMap[ach.skinReward].emoji} Skin` : '');
                        document.getElementById('ach-reward').style.color = 'var(--accent)';
                        statusText = 'Oyun kayÄ±tlarÄ±nÄ±zda bulunmaktadÄ±r.';
                    } else {
                        document.getElementById('ach-reward').style.color = 'var(--warning)';
                    }
                    
                    document.getElementById('ach-reward').textContent = rewardText;
                    document.getElementById('ach-status').textContent = statusText;

                    document.getElementById('ach-info-modal').classList.add('open');
                },
                
                openWeightedModal: function() {
                    const container = document.getElementById('weighted-inputs');
                    container.innerHTML = '';
                    
                    if (Game.state.weightedConfig.length === 0) {
                        Game.state.weightedConfig = JSON.parse(JSON.stringify(Game.defaults['NORMAL']));
                    }
                    
                    let totalWeight = 0;

                    Game.state.weightedConfig.forEach((o, index) => {
                        totalWeight += o.weight;
                        container.innerHTML += `
                            <div class="input-group">
                                <span class="input-emoji">${o.emoji}</span>
                                <input type="text" value="${o.name}" class="input-text" id="weighted-name-${index}" style="flex:1;">
                                <input type="number" id="weight-${index}" class="input-text" value="${o.weight.toFixed(2)}" min="0" max="100" step="0.01" style="width: 80px;" oninput="Game.ui.updateWeightedTotal()">
                                <span style="width: 20px;">%</span>
                            </div>
                        `;
                    });
                    document.getElementById('weighted-total').textContent = `${totalWeight.toFixed(2)}%`;
                    Game.ui.updateWeightedTotal(); 
                    document.getElementById('weighted-modal').classList.add('open');
                },
                
                updateWeightedTotal: function() {
                    const inputs = document.querySelectorAll('#weighted-inputs input[type="number"]');
                    let total = 0;
                    inputs.forEach(input => {
                        total += parseFloat(input.value) || 0;
                    });
                    const totalEl = document.getElementById('weighted-total');
                    const errorEl = document.getElementById('weighted-error');
                    
                    totalEl.textContent = `${total.toFixed(2)}%`;
                    if (Math.abs(total - 100) > 0.01) {
                        totalEl.style.color = 'var(--danger)';
                        errorEl.textContent = `Hata: Toplam aÄŸÄ±rlÄ±k 100% olmalÄ±. Fark: ${(total - 100).toFixed(2)}%`;
                    } else {
                        totalEl.style.color = 'var(--primary)';
                        errorEl.textContent = '';
                    }
                },
                
                openCustomModal: function() {
                    const container = document.getElementById('custom-inputs');
                    container.innerHTML = '';
                    
                    if (Game.state.customOutcomes.length > 0) {
                        Game.state.customOutcomes.forEach((o, index) => {
                             Game.ui.addCustomInput(o.name, o.emoji, o.color);
                        });
                    } else {
                        Game.ui.addCustomInput('YazÄ±', 'âœï¸', '#ff7675');
                        Game.ui.addCustomInput('Tura', 'ğŸ‘‘', '#00b894');
                    }
                    document.getElementById('custom-modal').classList.add('open');
                },

                addCustomInput: function(name = '', emoji = 'â“', color = '#999999') {
                    const container = document.getElementById('custom-inputs');
                    if (container.children.length >= 5) {
                        alert("Maksimum 5 sonuÃ§ ekleyebilirsiniz.");
                        return;
                    }
                    
                    const index = container.children.length;

                    const newGroup = document.createElement('div');
                    newGroup.className = 'input-group';
                    newGroup.id = `custom-input-${index}`;
                    newGroup.innerHTML = `
                        <input type="text" placeholder="AdÄ±" value="${name}" id="custom-name-${index}" class="input-text" style="flex:2;">
                        <input type="text" placeholder="Emoji" value="${emoji}" id="custom-emoji-${index}" class="input-text input-emoji" maxlength="2" style="flex:0.5;">
                        <input type="color" value="${color}" id="custom-color-${index}" class="input-color">
                        <button onclick="document.getElementById('custom-input-${index}').remove()" class="icon-btn" style="color:var(--danger); font-size:1.2rem;">ğŸ—‘ï¸</button>
                    `;
                    container.appendChild(newGroup);
                },

                fireConfetti: function(color) {
                    // Confetti animasyonu (basit tutuldu)
                },

                // Yeni Fonksiyon: Skin temasÄ±nÄ± body'ye uygula
                applySkinTheme: function(skinId) {
                    const skin = Game.skinsMap[skinId];
                    const body = document.body;
                    
                    // Ã–nceki temayÄ± temizle
                    body.classList.remove('theme-applied');
                    body.style.backgroundImage = 'none';
                    body.style.backgroundColor = 'var(--bg-color)'; 
                    body.style.color = 'var(--text-main)'; 

                    if (skin && skin.theme) {
                        body.classList.add('theme-applied');
                        if (skin.theme.backgroundImage) {
                            body.style.backgroundImage = skin.theme.backgroundImage;
                            body.style.color = skin.theme.color || '#ffffff'; // Tema varsa metin rengini ayarla
                            // Koyu moddaki card'larÄ±n arkaplanÄ±nÄ± yarÄ± ÅŸeffaf yapabiliriz (Opsiyonel)
                        } else if (skin.theme.backgroundColor) {
                            body.style.backgroundColor = skin.theme.backgroundColor;
                            body.style.color = skin.theme.color || '#ffffff';
                        }
                    }
                },


                render: function() {
                    Game.ui.renderStats();
                    Game.ui.renderAchievements();
                    Game.ui.renderHeader(); 
                    Game.ui.initializeCoinVisuals(Game.state.mode);
                    Game.ui.updateFlipSpeed();
                    Game.ui.applySkinTheme(Game.state.activeSkin); // YÃ¼klenirken temayÄ± uygula
                },
                
                toggleTheme: function() {
                    document.body.classList.toggle('dark-mode');
                    const isDark = document.body.classList.contains('dark-mode');
                    localStorage.setItem('CF_V11_THEME', isDark ? 'dark' : 'light');
                    
                    // TemayÄ± deÄŸiÅŸtirdikten sonra coin gÃ¶rselini ve genel body temayÄ± gÃ¼ncelle
                    Game.ui.initializeCoinVisuals(Game.state.mode);
                    Game.ui.applySkinTheme(Game.state.activeSkin);
                }

            }
        };

        // --- BAÅLATMA ---
        window.onload = function() {
            Game.data.load();
            
            document.body.addEventListener('click', function() {
                Game.audio.init();
            }, { once: true });
        };
    </script>
</body>
    </html>
